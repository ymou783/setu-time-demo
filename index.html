<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>涩图time • 第一期</title>
    <meta name="color-scheme" content="light dark" />
    <style>
      :root {
        --bg: #f6f7fb;
        --surface: #fff;
        --text: #1b1e27;
        --muted: #6b7280;
        --outline: rgba(20, 22, 30, 0.08);
        --ring: rgba(255, 85, 85, 0.15);
        --radius: 14px;
        --gap: 14px;
        --accent1: #ff6a6a;
        --accent2: #ff3d99;
        --wm-size: 240px;
        --wm-rotate: -24deg;
        --wm-opacity: 0.18;
        --wm-bg: none;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font: 14px/1.6 system-ui, -apple-system, Segoe UI, Roboto, PingFang SC,
          Microsoft YaHei, Helvetica, Arial, sans-serif;
        color: var(--text);
        background: var(--bg);
      }
      .topbar {
        position: sticky;
        top: 0;
        z-index: 40;
        display: grid;
        grid-template-columns: auto 1fr auto;
        align-items: center;
        padding: 14px 18px;
        border-bottom: 1px solid var(--outline);
        background: rgba(250, 250, 252, 0.75);
        backdrop-filter: saturate(1.2) blur(8px);
      }
      .brand {
        justify-self: center;
        font-size: clamp(18px, 2.4vw, 28px);
        line-height: 1.2;
        font-weight: 800;
        letter-spacing: 0.2px;
        white-space: nowrap;
        color: #2a2f3a;
        opacity: 0.9;
      }
      .menu-btn {
        appearance: none;
        -webkit-appearance: none;
        cursor: pointer;
        border: 1px solid var(--outline);
        background: var(--surface);
        color: var(--text);
        border-radius: 10px;
        padding: 8px 12px;
        font-weight: 700;
      }
      .menu-btn:hover {
        filter: brightness(1.03);
      }
      .menu-btn:focus-visible {
        outline: 2px solid var(--accent1);
        outline-offset: 2px;
      }
      .drawer {
        position: fixed;
        inset: 0 auto 0 0;
        width: min(280px, 86vw);
        background: var(--surface);
        border-right: 1px solid var(--outline);
        transform: translateX(-100%);
        transition: transform 0.18s ease-out;
        z-index: 90;
        padding: 12px 10px 18px;
        overflow: auto;
        box-shadow: 6px 0 24px rgba(0, 0, 0, 0.08);
      }
      .drawer.open {
        transform: translateX(0);
      }
      .scrim {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.35);
        z-index: 80;
      }
      .scrim[hidden] {
        display: none;
      }
      .nav-header {
        font-weight: 800;
        padding: 6px 10px 10px;
      }
      .nav-group {
        margin: 6px 8px;
      }
      .nav-group details {
        border: 1px solid var(--outline);
        border-radius: 12px;
        background: var(--surface);
        overflow: hidden;
        margin: 8px 0;
      }
      .nav-group summary {
        list-style: none;
        cursor: pointer;
        padding: 10px 12px;
        font-weight: 700;
      }
      .nav-group summary::-webkit-details-marker {
        display: none;
      }
      .nav-group ul {
        margin: 0;
        padding: 6px 0 10px 0;
      }
      .nav-group li {
        list-style: none;
      }
      .nav-group a {
        display: block;
        margin: 2px 8px;
        padding: 8px 12px;
        border-radius: 8px;
        color: var(--text);
        text-decoration: none;
      }
      .nav-group a:hover {
        background: rgba(59, 130, 246, 0.08);
      }
      .wrap {
        width: min(1200px, 100%);
        margin: 0 auto;
        padding: 14px clamp(10px, 3vw, 18px) 120px;
      }

      /* 标题下自定义文本框 */
      .custom-text {
        width: min(1200px, 100%);
        margin: 16px auto 0;
        padding: 12px 18px;
        background: var(--surface);
        border: 1px solid var(--outline);
        border-radius: var(--radius);
        font-size: 16px;
        line-height: 1.6;
        color: var(--text);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      }
      .custom-text p {
        margin: 0;
      }

      /* 单列布局，每行一个媒体 */
      .grid {
        display: flex;
        flex-direction: column;
        gap: var(--gap);
      }
      .card {
        display: block;
        width: 100%;
        max-width: 100%;
        break-inside: avoid;
        margin: 0;
        border-radius: var(--radius);
        background: var(--surface);
        border: 1px solid var(--outline);
        box-shadow: 0 1px 0 rgba(0, 0, 0, 0.02);
        overflow: hidden;
        transition: transform 0.12s ease, box-shadow 0.12s ease;
      }
      .card:where(:hover, :focus-visible) {
        transform: translateY(-1px);
        box-shadow: 0 6px 18px rgba(16, 24, 40, 0.08);
      }
      .thumb-wrap {
        position: relative;
        overflow: hidden;
      }
      .thumb {
        display: block;
        width: 100%;
        height: auto;
        object-fit: contain;
        aspect-ratio: auto;
        background: #eee;
      }
      .meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 12px;
        color: var(--muted);
        font-size: 12px;
        border-top: 1px solid var(--outline);
      }

      /* 水印叠加（仅缩略图层） */
      .thumb-wrap::after {
        content: "";
        position: absolute;
        inset: -20%;
        background-image: var(--wm-bg);
        background-repeat: repeat;
        background-size: var(--wm-size) var(--wm-size);
        transform: rotate(var(--wm-rotate));
        opacity: var(--wm-opacity);
        pointer-events: none;
        z-index: 1;
      }

      /* 右下角悬浮按钮等 */
      .fab {
        position: fixed;
        right: 16px;
        bottom: calc(16px + env(safe-area-inset-bottom));
        z-index: 30;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 14px 18px;
        border-radius: 999px;
        gap: 8px;
        text-decoration: none;
        color: #fff;
        font-weight: 700;
        background: linear-gradient(135deg, var(--accent1), var(--accent2));
        box-shadow: 0 12px 30px rgba(255, 82, 120, 0.35);
        transition: transform 0.12s ease, box-shadow 0.12s ease;
        font-size: clamp(14px, 2vw, 18px);
      }
      .fab:where(:hover, :focus-visible) {
        transform: translateY(-1px);
        box-shadow: 0 16px 40px rgba(255, 82, 120, 0.45);
      }

      .download-card {
        width: min(760px, 92%);
        margin: 40px auto 16px;
        padding: 22px 24px;
        border-radius: 20px;
        background: var(--surface);
        border: 1px solid var(--outline);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
        text-align: center;
      }
      .download-card h3 {
        margin: 0 0 8px;
        font-size: 20px;
        font-weight: 800;
        background: linear-gradient(135deg, var(--accent1), var(--accent2));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }
      .download-card p {
        margin: 0 0 14px;
        color: var(--muted);
      }
      .download-btn {
        display: inline-block;
        padding: 10px 16px;
        border-radius: 999px;
        color: #fff;
        text-decoration: none;
        font-weight: 700;
        background: linear-gradient(135deg, var(--accent1), var(--accent2));
        box-shadow: 0 10px 24px rgba(255, 82, 120, 0.3);
      }

      .bottom-cta {
        width: min(760px, 92%);
        margin: 26px auto 40px;
        text-align: center;
      }
      .bottom-cta .cta-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 14px 26px;
        border-radius: 9999px;
        text-decoration: none;
        font-weight: 700;
        color: #fff;
        background: linear-gradient(135deg, #60a5fa, #3b82f6);
        box-shadow: 0 10px 24px rgba(59, 130, 246, 0.25);
        transition: transform 0.12s ease, box-shadow 0.12s ease,
          filter 0.12s ease;
        font-size: clamp(16px, 2.2vw, 20px);
      }
      .bottom-cta .cta-btn:hover {
        filter: brightness(1.05);
        box-shadow: 0 12px 28px rgba(59, 130, 246, 0.35);
      }
      .bottom-cta .cta-btn:active {
        transform: translateY(1px);
      }

      @supports not (
        (backdrop-filter: blur(8px)) or (-webkit-backdrop-filter: blur(8px))
      ) {
        .topbar {
          background: #fafafc;
        }
      }

      /* Gate（有密码时隐藏主体） */
      [data-locked="1"] header,
      [data-locked="1"] #main,
      [data-locked="1"] .fab {
        display: none !important;
      }
      .gate {
        position: fixed;
        inset: 0;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
        background: radial-gradient(
          120% 120% at 50% 0%,
          rgba(0, 0, 0, 0.25),
          rgba(0, 0, 0, 0.45)
        );
        backdrop-filter: blur(6px);
      }
      .gate[hidden] {
        display: none;
      }
      .gate-card {
        width: min(420px, 92%);
        background: var(--surface);
        border: 1px solid var(--outline);
        border-radius: 16px;
        padding: 22px 20px 18px;
        text-align: center;
        box-shadow: 0 12px 36px rgba(0, 0, 0, 0.25);
      }
      .gate-card h1 {
        margin: 0 0 8px;
        font-size: 20px;
        font-weight: 800;
      }
      .gate-card p {
        margin: 0 0 14px;
        color: var(--muted);
      }
      .gate-input {
        width: 100%;
        height: 40px;
        border-radius: 10px;
        border: 1px solid var(--outline);
        padding: 0 12px;
        font: inherit;
      }
      .gate-actions {
        margin-top: 12px;
        display: flex;
        gap: 10px;
        justify-content: center;
      }
      .btn-solid {
        padding: 10px 16px;
        border-radius: 999px;
        border: 0;
        cursor: pointer;
        color: #fff;
        font-weight: 700;
        background: linear-gradient(135deg, var(--accent1), var(--accent2));
        box-shadow: 0 10px 24px rgba(255, 82, 120, 0.3);
      }
      .gate-msg {
        min-height: 20px;
        margin-top: 8px;
        color: #c1121f;
        font-weight: 700;
      }

      @media (prefers-reduced-motion: reduce) {
        .card,
        .fab,
        .bottom-cta .cta-btn {
          transition: none;
        }
      }
      .loading {
        width: min(1200px, 100%);
        margin: 14px auto 0;
        color: var(--muted);
        padding: 0 6px;
      }
    </style>
  </head>
  <body data-locked="1">
    <!-- 访问密码 Gate -->
    <div
      id="gate"
      class="gate"
      role="dialog"
      aria-modal="true"
      aria-labelledby="gateTitle"
    >
      <form id="gateForm" class="gate-card">
        <h1 id="gateTitle">请输入访问密码</h1>
        <p>每次进入都需验证</p>
        <input
          id="gatePwd"
          class="gate-input"
          type="password"
          placeholder="密码"
          autocomplete="current-password"
        />
        <div class="gate-actions">
          <button type="submit" class="btn-solid">进入</button>
        </div>
        <div id="gateMsg" class="gate-msg" aria-live="polite"></div>
      </form>
    </div>

    <header class="topbar" role="banner">
      <button
        class="menu-btn"
        id="menuBtn"
        aria-expanded="false"
        aria-controls="menuDrawer"
      >
        目录
      </button>
      <div class="brand">涩图time • 第一期</div>
      <div class="spacer"></div>
    </header>

    <!-- 标题下、媒体上 自定义文本框 -->
    <div class="custom-text">
      <p>
        这里是可自定义的公告/介绍文本。你可以写期刊说明、更新日志、观看提示等内容。
      </p>
    </div>

    <!-- 左侧目录抽屉 -->
    <aside id="menuDrawer" class="drawer" aria-label="站点目录" tabindex="-1">
      <div class="nav-header">目录</div>
      <nav class="nav-group" id="menuList"></nav>
    </aside>
    <div id="scrim" class="scrim" hidden></div>

    <main id="main" class="wrap">
      <div id="status" class="loading" aria-live="polite">
        正在加载媒体文件…
      </div>
      <section id="grid" class="grid" aria-live="polite"></section>
      <div id="io-sentinel" style="height: 1px"></div>

      <section class="download-card" aria-label="下载原图">
        <h3>本期无水印原图</h3>
        <p>保存到自己的网盘防止和谐</p>
        <a
          class="download-btn"
          href="https://example.com/download"
          target="_blank"
          rel="noopener"
          >点击下载</a
        >
      </section>

      <section class="bottom-cta" aria-label="添加好友获取更新">
        <a
          id="btn-bottom-cta"
          class="cta-btn"
          href="#"
          target="_blank"
          rel="noopener"
          >点击按钮添加QQ：38190187</a
        >
      </section>
    </main>

    <!-- 右下角悬浮按钮 -->
    <a
      class="fab"
      href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=38190187&website=www.oicqzone.com"
      target="_blank"
      rel="noopener"
      aria-label="添加QQ"
      >点击按钮添加qq：38190187</a
    >

    <script>
      /* ========= 自动发现 image/ 下文件：优先 GitHub Pages，其次目录索引 ========= */
      const IMAGE_EXT = [
        ".jpg",
        ".jpeg",
        ".png",
        ".gif",
        ".webp",
        ".bmp",
        ".avif",
      ];
      const VIDEO_EXT = [".mp4", ".mov", ".webm", ".m4v", ".ogg"];
      const MIME_BY_EXT = {
        ".jpg": "image/jpeg",
        ".jpeg": "image/jpeg",
        ".png": "image/png",
        ".gif": "image/gif",
        ".webp": "image/webp",
        ".bmp": "image/bmp",
        ".avif": "image/avif",
        ".mp4": "video/mp4",
        ".mov": "video/quicktime",
        ".webm": "video/webm",
        ".m4v": "video/x-m4v",
        ".ogg": "video/ogg",
      };
      const isImage = (f) => IMAGE_EXT.some((e) => f.toLowerCase().endsWith(e));
      const isVideo = (f) => VIDEO_EXT.some((e) => f.toLowerCase().endsWith(e));
      const guessMime = (f) => {
        const e = Object.keys(MIME_BY_EXT).find((x) =>
          f.toLowerCase().endsWith(x)
        );
        return e ? MIME_BY_EXT[e] : "";
      };

      async function listViaGitHubAPI() {
        const host = location.hostname;
        let owner = null,
          repo = null,
          branch = "main";
        if (host.endsWith("github.io")) {
          owner = host.split(".")[0];
          const seg = location.pathname.split("/").filter(Boolean);
          repo = seg[0] || `${owner}.github.io`;
        }
        if (!owner || !repo) return null;

        async function fetchDir(ref) {
          const url = `https://api.github.com/repos/${owner}/${repo}/contents/image?ref=${encodeURIComponent(
            ref
          )}`;
          const r = await fetch(url, {
            headers: { Accept: "application/vnd.github+json" },
          });
          if (!r.ok) return null;
          return { items: await r.json(), ref };
        }
        let res = await fetchDir(branch);
        if (!res) {
          branch = "master";
          res = await fetchDir(branch);
        }
        if (!res) return null;

        const list = res.items?.filter((x) => x.type === "file") || [];
        return list.map((x) => ({
          path: x.path,
          url: x.download_url,
          name: x.name,
        }));
      }

      async function listViaDirectoryIndex() {
        try {
          const r = await fetch("image/", { mode: "cors" });
          if (!r.ok) return null;
          const html = await r.text();
          const hrefs = [...html.matchAll(/href="([^"]+)"/gi)].map((m) => m[1]);
          const files = hrefs.filter((h) => isImage(h) || isVideo(h));
          if (!files.length) return null;
          return files.map((name) => ({
            path: "image/" + name.replace(/^\.?\//, ""),
            url: "image/" + name.replace(/^\.?\//, ""),
            name,
          }));
        } catch {
          return null;
        }
      }

      async function discoverMedia() {
        let entries = await listViaGitHubAPI();
        if (!entries) entries = await listViaDirectoryIndex();
        if (!entries) entries = [];
        const media = [];
        for (const e of entries.sort((a, b) =>
          a.name.localeCompare(b.name, "zh-Hans-CN")
        )) {
          if (isImage(e.name)) {
            media.push({ type: "image", src: e.url, title: e.name });
          } else if (isVideo(e.name)) {
            media.push({
              type: "video",
              title: e.name,
              poster: "",
              sources: [{ src: e.url, type: guessMime(e.name) }],
            });
          }
        }
        return media;
      }

      /* ============== 渲染（无灯箱；视频就地播放） ============== */
      const NAV = [
        {
          title: "往期",
          items: [
            { label: "第 01 期", href: "./index.html" },
            { label: "第 02 期", href: "./setu/2/" },
            { label: "第 03 期", href: "./setu/3/" },
          ],
        },
        {
          title: "快捷入口",
          items: [
            { label: "无水印原图", href: "https://example.com/download" },
            { label: "添加作者 QQ", href: "#", _syncFromFab: true },
          ],
        },
      ];

      const grid = document.getElementById("grid");
      const sentinel = document.getElementById("io-sentinel");
      const statusEl = document.getElementById("status");
      const mainEl = document.getElementById("main");

      let page = 0;
      const pageSize = 18;
      let MEDIA = [];
      let filtered = [];
      let isLoading = false;

      function getThumbSrc(item) {
        if (item.thumb) return item.thumb;
        return `${item.src}?auto=format&w=1200&q=80&fit=max`;
      }

      function renderNextPage() {
        if (isLoading) return;
        isLoading = true;
        const start = page * pageSize;
        const list = filtered.slice(start, start + pageSize);

        list.forEach((item) => {
          const card = document.createElement("article");
          card.className = "card";
          card.dataset.type = item.type || "image";

          if (item.type === "video") {
            // 视频：原地播放（移动端友好）
            const wrap = document.createElement("div");
            wrap.className = "thumb-wrap";
            const v = document.createElement("video");
            v.className = "thumb";
            v.setAttribute("preload", "metadata");
            v.setAttribute("playsinline", ""); // iOS 内联播放
            v.setAttribute("webkit-playsinline", ""); // 旧版 iOS
            v.setAttribute("controls", ""); // 显示控件（用户可播放）
            if (item.poster) v.setAttribute("poster", item.poster);
            (item.sources || []).forEach((s) => {
              const so = document.createElement("source");
              so.setAttribute("data-src", s.src);
              if (s.type) so.type = s.type;
              v.appendChild(so);
            });
            wrap.appendChild(v);
            card.appendChild(wrap);
          } else {
            const wrap = document.createElement("div");
            wrap.className = "thumb-wrap";
            const img = document.createElement("img");
            img.className = "thumb";
            img.src = getThumbSrc(item);
            img.loading = "lazy";
            img.decoding = "async";
            img.alt = item.title || "媒体预览";
            wrap.appendChild(img);
            card.appendChild(wrap);
          }

          const meta = document.createElement("div");
          meta.className = "meta";
          meta.innerHTML = `<span>${item.title || "未命名"}</span><span>${
            item.type === "video" ? "视频" : "图片"
          }</span>`;
          card.appendChild(meta);

          grid.appendChild(card);
        });

        page++;
        isLoading = false;

        // 懒加载视频源
        grid.querySelectorAll("video.thumb").forEach((v) => ioVideo.observe(v));

        if (page * pageSize >= filtered.length) {
          try {
            io.unobserve(sentinel);
          } catch {}
        }
      }

      const io = new IntersectionObserver(
        (entries) =>
          entries.forEach((ent) => {
            if (ent.isIntersecting) renderNextPage();
          }),
        { rootMargin: "1000px 0px" }
      );

      const ioVideo = new IntersectionObserver(
        (entries) => {
          entries.forEach((ent) => {
            if (!ent.isIntersecting) return;
            const v = ent.target;
            const sources = v.querySelectorAll("source[data-src]");
            sources.forEach((s) => {
              s.src = s.dataset.src;
              s.removeAttribute("data-src");
            });
            v.load(); // 加载元数据；用户点播放即可
            ioVideo.unobserve(v);
          });
        },
        { rootMargin: "600px" }
      );

      function renderNav() {
        const root = document.getElementById("menuList");
        if (!root) return;
        root.innerHTML = "";
        NAV.forEach((sec) => {
          const d = document.createElement("details");
          const s = document.createElement("summary");
          s.textContent = sec.title;
          d.appendChild(s);
          const ul = document.createElement("ul");
          (sec.items || []).forEach((it) => {
            const li = document.createElement("li");
            const a = document.createElement("a");
            a.textContent = it.label;
            a.href = it._syncFromFab
              ? document.querySelector(".fab")?.href || "#"
              : it.href;
            a.target = "_blank";
            a.rel = "noopener";
            li.appendChild(a);
            ul.appendChild(li);
          });
          d.appendChild(ul);
          root.appendChild(d);
        });
      }
      renderNav();

      /* —— 目录抽屉开关 —— */
      const menuBtn = document.getElementById("menuBtn");
      const drawer = document.getElementById("menuDrawer");
      const scrim = document.getElementById("scrim");
      let lastFocus = null;
      function openDrawer() {
        drawer.classList.add("open");
        scrim.hidden = false;
        menuBtn.setAttribute("aria-expanded", "true");
        lastFocus = document.activeElement;
        document.body.style.overflow = "hidden";
        const firstLink = drawer.querySelector("a");
        if (firstLink) firstLink.focus();
      }
      function closeDrawer() {
        drawer.classList.remove("open");
        scrim.hidden = true;
        menuBtn.setAttribute("aria-expanded", "false");
        document.body.style.overflow = "";
        if (lastFocus && lastFocus.focus) lastFocus.focus();
      }
      menuBtn.addEventListener("click", () =>
        drawer.classList.contains("open") ? closeDrawer() : openDrawer()
      );
      scrim.addEventListener("click", closeDrawer);
      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && drawer.classList.contains("open"))
          closeDrawer();
      });
      drawer.addEventListener("click", (e) => {
        if (e.target.tagName.toLowerCase() === "a") closeDrawer();
      });

      (function syncBottomBtnHref() {
        var fab = document.querySelector(".fab");
        var bottomBtn = document.getElementById("btn-bottom-cta");
        if (fab && bottomBtn) bottomBtn.href = fab.href;
      })();

      /* ======== 密码 Gate（每次输入；支持哈希/明文兜底） ======== */
      const GATE = {
        salt: "st-time-v1",
        hash: "946174e4dfa66e0471d5a5fa8d134975784e1ce759c9faf421b5559464be8f63", // sha256('1234'+salt)
        remember: false,
        ttlHours: 24,
        storageKey: "gate_v1_token",
        plain: "1234",
      };
      async function sha256Hex(str) {
        if (window.crypto && crypto.subtle) {
          try {
            const buf = await crypto.subtle.digest(
              "SHA-256",
              new TextEncoder().encode(str)
            );
            return [...new Uint8Array(buf)]
              .map((b) => b.toString(16).padStart(2, "0"))
              .join("");
          } catch (e) {}
        }
        return null;
      }
      window._gateHash = async (pwd) =>
        console.log(await sha256Hex(pwd + GATE.salt));

      const gateEl = document.getElementById("gate");
      const gateForm = document.getElementById("gateForm");
      const gatePwd = document.getElementById("gatePwd");
      const gateMsg = document.getElementById("gateMsg");

      function unlockUI(silent) {
        gateEl.hidden = true;
        document.body.removeAttribute("data-locked");
        if (!silent) gateMsg.textContent = "";
        if (!window.__booted) {
          window.__booted = true;
          (async () => {
            try {
              MEDIA = await discoverMedia();
              filtered = MEDIA.slice();
              statusEl.textContent = MEDIA.length
                ? `已加载 ${MEDIA.length} 个文件`
                : "未在 image/ 目录发现文件";
              try {
                io.observe(sentinel);
              } catch {}
              renderNextPage();
            } catch (err) {
              console.error(err);
              statusEl.textContent = "媒体加载失败";
            }
          })();
        }
      }
      (function gateInit() {
        gateEl.hidden = false;
        setTimeout(() => gatePwd.focus(), 0);
      })();
      gateForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        gateMsg.textContent = "";
        const input = (gatePwd.value || "").trim();
        if (!input) {
          gateMsg.textContent = "请输入密码";
          gatePwd.focus();
          return;
        }
        const h = await sha256Hex(input + GATE.salt);
        const ok =
          (h && GATE.hash && h === GATE.hash) ||
          (!h && GATE.plain && input === GATE.plain);
        if (ok) unlockUI(false);
        else {
          gateMsg.textContent = "密码不正确";
          gatePwd.select();
        }
      });

      /* —— 全站水印写入 —— */
      const WM_TEXT = "qq:38190187"; // ← 改成你的水印文字
      const WM_SIZE = 240;
      const WM_COLOR = "#FFFFFF";
      (function setGlobalWatermark() {
        const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${WM_SIZE}" height="${WM_SIZE}" viewBox="0 0 ${WM_SIZE} ${WM_SIZE}">
  <style>text{ font:700 18px system-ui,-apple-system,'Segoe UI',Roboto,'PingFang SC','Microsoft YaHei',Arial; }</style>
  <text x="16" y="${WM_SIZE / 2}" fill="${WM_COLOR}">${WM_TEXT}</text>
</svg>`;
        const url = `url("data:image/svg+xml;utf8,${encodeURIComponent(svg)}")`;
        document.documentElement.style.setProperty("--wm-bg", url);
      })();
    </script>
  </body>
</html>
